(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("router");var r=e.n(t);const a=require("appData");var s=e.n(a);const n=require("Properties");var o=e.n(n);const i=require("events");var c=e.n(i);const u=require("MailBuilder");var d=e.n(u);const g=require("ResourceLocatorUtil");var l=e.n(g);const v=require("LogUtil");var p=e.n(v);const f=require("storage");var m=e.n(f);const b=require("PortletContextUtil");var h=e.n(b);r().get("/currentUser",(function(e,t){var r=h().getCurrentUser(),a=o().get(r,"mail");t.json({mail:a})}));var y=m().getCollectionDataStore("messages");r().post("/feedback",(function(e,t){var r=e.params.messages;try{var a=y.add({messages:r});t.json({post:a})}catch(e){console.log("Failded to add message to messages-datastore. cause:"+JSON.stringify(e))}t.status(200)})),r().get("/messages",(function(e,t){var r=y.find("*");t.json(r.toArray())})),c().on("sv:publishing:publish",(function(e){var t=l().getNodeByIdentifier(e.node);d().setSubject(t+"was published").setTextMessage(e.emitter+"published"+t).addRecipient("filip.huhta@consid.se").build().send()})),c().on("sv:traschcan:add",(function(e){var t=l().getNodeByIdentifier(e.node);p().info(t+"Was added to the traschcan by"+e.emitter)})),r().get("/currentPageProperty",(function(e,t){var r=e.params.value,a=s().get("page"),n=o().get(a,r);t.json({pageName:n})}))})();