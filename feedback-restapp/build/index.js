(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("router");var r=e.n(t);require("appData"),require("Properties");const i=require("events");var o=e.n(i);const a=require("MailBuilder");var n=e.n(a);const s=require("ResourceLocatorUtil");var d=e.n(s);const c=require("LogUtil");var l=e.n(c);const u=require("storage");var f=e.n(u)().getCollectionDataStore("feedbackStore");require("PropertyUtil"),r().get("/getFeedback",(function(e,t){var r=f.find("*").toArray();t.status(200).json({data:r})})),r().post("/addFeedback",(function(e,t){l().info("testing: "+JSON.stringify(e));var r,i=function(e){var t;try{t=f.add(e),f.instantIndex(t.dsid)}catch(e){l().info("Could not write to DataStore")}return t}(e.params.value);i&&n().setSubject("Page "+i.feedbackPage+" was published with feedback.").setHtmlMessage((r=i,'<div style=" background-color: #80c5ff; height:100%; margin: 10px; border-radius: 5px; padding: 20px;"><h2 style="text-align: center; font-size:30px; color: white;"> Message from Filips Sitevision site </h2><div style="color: white; text-align: center; font-size:14px; height: 200px; background-color:#004a90; padding: 20px; border: 1px solid white;"><p style="color: white;">The page with name: '+r.feedbackPage+' have recived new feedback. </p><p style="color: white;">Published feedback: "'+r.message+'"</p> <a style="color: white;" href="'+r.feedbackPageURL+'" >Read more on Filips Sitevision site -> </a></div></div>')).addRecipient("filip.huhta@consid.se").build().send(),i&&t.status(200).json({data:i})})),o().on("sv:publishing:publish",(function(e){var t=d().getNodeByIdentifier(e.node);l().info("Testar events: "+JSON.stringify(e)),l().info(t)})),r().put("/myroute",(function(e,t){t.json({message:"Hello from PUT"})})),r().delete("/myroute",(function(e,t){t.json({message:"Hello from DELETE"})}))})();