(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("router");var i=e.n(t);require("appData"),require("Properties");const r=require("events");var n=e.n(r);const o=require("MailBuilder");var a=e.n(o);const s=require("ResourceLocatorUtil");var d=e.n(s);const c=require("LogUtil");var u=e.n(c);const f=require("storage");var l=e.n(f)().getCollectionDataStore("feedbackStore"),g=function(){return l.find("*").toArray()};const p=require("PropertyUtil");var h=e.n(p);i().get("/getFeedback",(function(e,t){var i=g();t.status(200).json({data:i})})),i().post("/addFeedback",(function(e,t){u().info("testing: "+JSON.stringify(e));var i,r=function(e){var t;try{t=l.add(e),l.instantIndex(t.dsid)}catch(e){u().info("Could not write to DataStore")}return t}(e.params.value);r&&a().setSubject("Page "+r.feedbackPage+" was published with feedback.").setHtmlMessage((i=r,'<div style=" background-color: #80c5ff; height:100%; margin: 10px; border-radius: 5px; padding: 20px;"><h2 style="text-align: center; font-size:30px; color: white;"> Message from Filips Sitevision site </h2><div style="color: white; text-align: center; font-size:14px; height: 200px; background-color:#004a90; padding: 20px; border: 1px solid white;"><p style="color: white;">The page with name: '+i.feedbackPage+' have recived new feedback. </p><p style="color: white;">Published feedback: "'+i.message+'"</p> <a style="color: white;" href="'+i.feedbackPageURL+'" >Read more on Filips Sitevision site -> </a></div></div>')).addRecipient("filip.huhta@consid.se").build().send(),r&&t.status(200).json({data:r})})),n().on("sv:publishing:publish",(function(e){var t=d().getNodeByIdentifier(e.node);u().info("Testar events: "+JSON.stringify(e)),u().info(h().getString(t,"displayName")),function(e){var t=g();u().info("Sidorna från början:"+JSON.stringify(t)),t.forEach((function(t){t.feedbackPage==e&&(u().info("En träff på sidan: "+JSON.stringify(t)),t.isOutdated||(t.isOutdated=!0,function(e,t){try{l.set(e,t)}catch(e){u().info("Could not write to DataStore")}}(t.dsid,t)))}))}(h().getString(t,"displayName"))})),i().put("/myroute",(function(e,t){t.json({message:"Hello from PUT"})})),i().delete("/myroute",(function(e,t){t.json({message:"Hello from DELETE"})}))})();