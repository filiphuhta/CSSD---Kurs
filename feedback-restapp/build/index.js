(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("router");var r=e.n(t);const a=require("events");var i=e.n(a);const n=require("MailBuilder");var o=e.n(n);const d=require("ResourceLocatorUtil");var s=e.n(d);const c=require("LogUtil");var u=e.n(c);const l=require("storage");var f=e.n(l)().getCollectionDataStore("feedbackStore"),p=function(){return f.find("*").toArray()};const g=require("PropertyUtil");var h=e.n(g);r().get("/getFeedback",(function(e,t){var r=p();t.status(200).json({data:r})})),r().post("/addFeedback",(function(e,t){var r=function(e){var t;try{t=f.add(e),f.instantIndex(t.dsid)}catch(e){u().info("Could not write to DataStore")}return t}(e.params.value);!function(e){var t;e&&o().setSubject("Sidan "+e.feedbackPage+" har fått feedback.").setHtmlMessage((t=e,'<div style=" background-color: #80c5ff; height:100%; margin: 10px; border-radius: 5px; padding: 20px;"><h2 style="text-align: center; font-size:30px; color: white;"> Meddelande från Filips CSSD sida </h2><div style="color: white; text-align: center; font-size:14px; height: 200px; background-color:#004a90; padding: 20px; border: 1px solid white;"><p style="color: white;">Sidan med namnet: '+t.feedbackPage+' har fått feedback. </p><p style="color: white;">Publicerad feedback: "'+t.message+'"</p> <a style="color: white;" href="'+t.feedbackPageURL+'" >Läs mer på Filips Sitevision sida -> </a></div></div>')).addRecipient("filip.huhta@consid.se").build().send()}(r),r&&t.status(200).json({data:r})})),i().on("sv:publishing:publish",(function(e){var t=s().getNodeByIdentifier(e.node);!function(e){p().forEach((function(t){t.feedbackPage==e&&(t.isOutdated||(t.isOutdated=!0,function(e,t){try{f.set(e,t)}catch(e){u().info("Could not write to DataStore")}}(t.dsid,t)))}))}(h().getString(t,"displayName"))}))})();